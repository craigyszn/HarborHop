{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HarborHop - Your Gateway to Maritime Adventures</title>
    <link href="https://fonts.googleapis.com/css2?family=Alan+Sans:wght@300..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/home.css' %}?v=11">
    <script src="https://kit.fontawesome.com/1256e3cde2.js" crossorigin="anonymous"></script>
</head>
<body>
  <!-- Header -->
<header>
    <div class="logo-container">
        <a href="{% url 'home' %}" class="logo">HARBOR<span>hop</span></a>
        <p class="tagline">Hop aboard. Sail beyond</p>
    </div>
    <nav>
        {% if user.is_authenticated %}
            <!-- Admin Dashboard Button - Only visible to admin users -->
            {% if user.profile.is_admin_user %}
                <a href="{% url 'admin_dashboard' %}" class="admin-dashboard-link">
                    <i class="fa-solid fa-chart-line dashboard-icon"></i> Admin Access
                </a>
            {% endif %}
            
            <a href="{% url 'home' %}">Transaction</a>
            <a href="#">Latest Offers</a>
            <a href="#">Contact Us</a>
            <div class="nav-divider"></div>
            <a href="#" class="language-link">PH</a>
            <span class="language-separator">|</span>
            <a href="#" class="language-link">EN</a>
            <a href="{% url 'profile_settings' %}" class="user-name-btn">{{ user.username }}</a>
            <a href="{% url 'logout' %}" class="login-btn">Log out</a>
        {% else %}
            <a href="#">Transaction</a>
            <a href="#">Latest Offers</a>
            <a href="#">Contact Us</a>
            <div class="nav-divider"></div>
            <a href="#" class="language-link">PH</a>
            <span class="language-separator">|</span>
            <a href="#" class="language-link">EN</a>
            <a href="{% url 'login' %}" class="login-btn">Log In</a>
        {% endif %}
    </nav>
</header>

    <!-- Hero Section with Booking Card -->
    <section class="hero-section">
        <div class="booking-card">
            <h2 class="booking-title">Find Your Trip</h2>
            <p class="booking-subtitle">Book ferry tickets and explore the wonders of the PH!</p>
            
            <form class="booking-form" method="POST" action="{% url 'search_trips' %}">
                {% csrf_token %}
                
                <!-- Trip Type Selection -->
                <div class="form-row trip-type-row">
                    <div class="trip-type-group">
                        <label class="trip-type-option">
                            <input type="radio" name="trip_type" value="round_trip" checked>
                            <span class="radio-custom"></span>
                            <span class="radio-label">Round Trip</span>
                        </label>
                        <label class="trip-type-option">
                            <input type="radio" name="trip_type" value="one_way">
                            <span class="radio-custom"></span>
                            <span class="radio-label">One Way</span>
                        </label>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="input-group">
                        <label>From</label>
                        <div class="input-wrapper">
                            <i class="fa-solid fa-location-dot input-icon"></i>
                            <select name="origin" id="origin-select" class="form-input" required>
                                <option value="">Loading locations...</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="swap-icon" onclick="swapLocations()"><i class="fa-solid fa-right-left"></i></div>
                    
                    <div class="input-group">
                        <label>To</label>
                        <div class="input-wrapper">
                            <i class="fa-solid fa-location-dot input-icon"></i>
                            <select name="destination" id="destination-select" class="form-input" required>
                                <option value="">Select origin first</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="input-group">
                        <label>Departure Date</label>
                        <div class="input-wrapper">
                            <i class="fa-solid fa-calendar-days input-icon"></i>
                            <input type="date" name="departure_date" class="form-input" required>
                        </div>
                    </div>
                    
                    <div class="input-group" id="return-date-group">
                        <label>Return Date</label>
                        <div class="input-wrapper">
                            <i class="fa-solid fa-calendar-days input-icon"></i>
                            <input type="date" name="return_date" class="form-input" id="return-date-input">
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="input-group">
                        <label>Select Shipping Lines</label>
                        <div class="input-wrapper">
                            <i class="fa-solid fa-ship input-icon"></i>
                            <select name="shipping_line" class="form-input">
                                <option value="">Any Shipping Line</option>
                                <option value="Lite Ferries">Lite Ferries</option>
                                <option value="Starlite Ferries">Starlite Ferries</option>
                                <option value="OceanJet">OceanJet</option>
                                <option value="2GO Travel">2GO Travel</option>
                                <option value="Archipelago Philippine Ferries Corporation">Archipelago Philippine Ferries Corporation</option>
                                <option value="SuperFerry">SuperFerry</option>
                                <option value="Trans-Asia Shipping Lines">Trans-Asia Shipping Lines</option>
                                <option value="Santa Clara Shipping Corp.">Santa Clara Shipping Corp.</option>
                                <option value="Cokaliong Shipping Lines">Cokaliong Shipping Lines</option>
                                <option value="FastCat">FastCat</option>
                                <option value="Montenegro Lines">Montenegro Lines</option>
                                <option value="Super Shuttle Ferry">Super Shuttle Ferry</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="form-row passengers">
                    <div class="passenger-group">
                        <i class="fa-solid fa-user passenger-icon"></i>
                        <div class="passenger-info">
                            <strong>Adults</strong>
                            <small>12 years and up</small>
                        </div>
                        <div class="counter">
                            <button type="button" class="counter-btn" onclick="decrementCounter(this)">
                                <i class="fa-solid fa-minus"></i>
                            </button>
                            <span class="counter-value">0</span>
                            <input type="hidden" name="adults" value="0">
                            <button type="button" class="counter-btn" onclick="incrementCounter(this)">
                                <i class="fa-solid fa-plus"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="passenger-group">
                        <i class="fa-solid fa-child passenger-icon"></i>
                        <div class="passenger-info">
                            <strong>Children</strong>
                            <small>2-11 years old</small>
                        </div>
                        <div class="counter">
                            <button type="button" class="counter-btn" onclick="decrementCounter(this)">
                                <i class="fa-solid fa-minus"></i>
                            </button>
                            <span class="counter-value">0</span>
                            <input type="hidden" name="children" value="0">
                            <button type="button" class="counter-btn" onclick="incrementCounter(this)">
                                <i class="fa-solid fa-plus"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="form-buttons">
                    <button type="submit" class="btn-submit">View Available Trips</button>
                </div>
            </form>
        </div>
    </section>

    <!-- Latest Offers Section -->
    <section class="latest-offers-section">
        <div class="section-header">
            <h2><i class="fa-solid fa-tags"></i> Latest Offers</h2>
            <p>Exclusive deals on popular routes across the Philippines</p>
        </div>
        <div class="offers-container">
            <div class="offer-card">
                <div class="price-badge">From â‚±999</div>
                <img src="https://static1.detourista.com/wp/wp-content/uploads/Unorganized/Boracay-Spots-Featured.jpg" alt="Boracay Express">
                <div class="offer-card-content">
                    <span class="tag limited">30% OFF</span>
                    <h3>Boracay Express</h3>
                    <p>Manila â†” Boracay<br>
                    Starting at â‚±999<br>
                    Valid until June 2024</p>
                </div>
            </div>

            <div class="offer-card">
                <div class="price-badge">Family Package</div>
                <img src="https://www.kkday.com/en-ph/blog/wp-content/uploads/FBblogCoverIslandHoppinginCebu-1170x630.jpg" alt="Cebu Island Hopper">
                <div class="offer-card-content">
                    <span class="tag limited">Family Package</span>
                    <h3>Cebu Island Hopper</h3>
                    <p>4 Islands in 1 Day<br>
                    Kids Travel Free<br>
                    Includes Lunch</p>
                </div>
            </div>

            <div class="offer-card">
                <div class="price-badge">Flash Sale</div>
                <img src="https://i.ytimg.com/vi/aWOdllk6u2U/mqdefault.jpg" alt="Palawan Adventure">
                <div class="offer-card-content">
                    <span class="tag limited">Flash Sale</span>
                    <h3>El Nido Express</h3>
                    <p>Manila â†” El Nido<br>
                    Buy 1 Get 1 Free<br>
                    24 Hours Only!</p>
                </div>
            </div>

            <div class="offer-card">
                <div class="price-badge">Student Offer</div>
                <img src="https://i.ytimg.com/vi/l6K6FgR2xB8/hq720.jpg?sqp=-oaymwEhCK4FEIIDSFryq4qpAxMIARUAAAAAGAElAADIQj0AgKJD&rs=AOn4CLCVmTDDTDEHhgshytd1yuDBy914bA" alt="Siargao Surfer">
                <div class="offer-card-content">
                    <span class="tag limited">Student Offer</span>
                    <h3>Siargao Surfer</h3>
                    <p>20% Student Discount<br>
                    Free Surf Board Transport<br>
                    Valid ID Required</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Why Use HarborHop Section -->
    <section class="why-use-section">
        <div class="section-header">
            <h2>Why Choose HarborHop?</h2>
            <p>Join thousands of happy travelers who trust us for their island-hopping adventures</p>
        </div>
        <div class="features-container">
            <div class="feature-card">
                <div class="feature-icon"><i class="fa-solid fa-hand-holding-dollar"></i></div>
                <img src="https://media.licdn.com/dms/image/v2/C4D1BAQFWtDwvyWttvg/company-background_10000/company-background_10000/0/1605151800225/best_price_cruises_cover?e=2147483647&v=beta&t=0Q-f57ZiNmjw-FZvjDUz0EamF6K6ihURFDPotNeLH9g" alt="Best Prices">
                <p><strong>Best Price Guarantee</strong><br>
                Get exclusive deals and up to 30% off on ferry tickets. We match any competitor's price!</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon"><i class="fa-solid fa-headset"></i></div>
                <img src="https://assets.princess.com/is/image/princesscruises/oceannow-crew-delivers-cocktails-couple-lounging-lido-deck-wearing-medallion:5x4?ts=1721071273083" alt="24/7 Support">
                <p><strong>24/7 Expert Support</strong><br>
                Our local travel experts are available round-the-clock to assist you in English and Filipino.</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon"><i class="fa-solid fa-tower-broadcast"></i></div>
                <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQ1LvSYGo6p2sttgDU8xW0kLq-xFo2SvsyrDw&s" alt="Real-time Updates">
                <p><strong>Real-time Updates</strong><br>
                Get instant notifications about schedule changes, weather updates, and live vessel tracking.</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon"><i class="fa-solid fa-cart-shopping"></i></div>
                <img src="https://blogimage.vantagecircle.com/content/images/2024/01/13-Corporate-Reward-Programs-with-Essentials--Benefits--Ideas--and-Steps.png" alt="Easy Booking">
                <p><strong>Seamless Booking</strong><br>
                Book your trips in minutes with our user-friendly platform. Instant confirmation and e-tickets.</p>
            </div>
            
            <div class="feature-card">
                <div class="feature-icon"><i class="fa-solid fa-gift"></i></div>
                <img src="https://blogimage.vantagecircle.com/content/images/2024/01/13-Corporate-Reward-Programs-with-Essentials--Benefits--Ideas--and-Steps.png" alt="Rewards Program">
                <p><strong>HopRewards Program</strong><br>
                Earn points on every booking and enjoy exclusive member benefits and priority boarding.</p>
            </div>
        </div>
    </section>

    <!-- Our Partners Section -->
<section class="partners-section">
    <div class="section-header">
        <h2>Our Partners</h2>
    </div>
    <div class="partners-container">
        <div class="partner-logo">
            <img src="https://upload.wikimedia.org/wikipedia/en/2/2f/Lite_ferries_logo.png" alt="Lite Ferries">
        </div>
        <div class="partner-logo">
            <img src="https://bustickets.ph/wp-content/uploads/2020/06/starlite-ferries.svg" alt="Starlite Ferries">
        </div>
        <div class="partner-logo">
            <img src="https://upload.wikimedia.org/wikipedia/en/thumb/0/05/OceanJet_logo.svg/250px-OceanJet_logo.svg.png" alt="OceanJet">
        </div>
        <div class="partner-logo">
            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/be/2GO_Travel_logo_%282018%29.svg/1200px-2GO_Travel_logo_%282018%29.svg.png" alt="2GO Travel">
        </div>
        <div class="partner-logo">
            <img src="https://upload.wikimedia.org/wikipedia/en/b/b5/APFC_company_logo.svg" alt="Archipelago Philippine Ferries Corporation">
        </div>
        <div class="partner-logo">
            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/32/SuperFerry_logo.svg/2560px-SuperFerry_logo.svg.png" alt="SuperFerry">
        </div>
        <div class="partner-logo">
            <img src="https://www.transasiashipping.com/wp-content/uploads/2023/05/TASLI-NEW.png" alt="Trans-Asia Shipping Lines">
        </div>
        <div class="partner-logo">
            <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSTP1yTyp1bl0ym8FXk_9rRTpTLsUlsvrJBPg&s" alt="Santa Clara Shipping Corp.">
        </div>
        <div class="partner-logo">
            <img src="https://media.glassdoor.com/sqll/632352/cokaliong-shipping-lines-squarelogo-1473157373209.png" alt="Cokaliong Shipping Lines">
        </div>
        <div class="partner-logo">
            <img src="https://ecpay.com.ph/sites/default/files/2024-01/FASTCAT.png" alt="FastCat">
        </div>
        <div class="partner-logo">
            <img src="https://montenegrolines.com.ph/assets/img/logo-01-current.png" alt="Montenegro Lines">
        </div>
        <div class="partner-logo">
            <img src="https://upload.wikimedia.org/wikipedia/commons/a/a4/Super_Shuttle_Logo.jpg" alt="Super Shuttle Ferry">
        </div>
    </div>
</section>

    <!-- Customer Service Section -->
    <section class="customer-service-section">
        <div class="customer-service-content">
            <div class="customer-service-text">
        <h2>
            <div class="service-icon"><i class="fa-solid fa-circle-question"></i></div>
            Customer Service
        </h2>
        <p>Visit our customer service page to find useful information on travelling by ferry, our FAQs, and how to contact us for help with your booking.</p>
            </div>
            <div class="customer-service-cta">
                <a href="#" class="need-help-btn">Need Help?</a>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <div class="footer-logo">
                    <div class="logo-text">HARBOR<span class="highlight">hop</span></div>
                    <p class="tagline">Hop Aboard. Sail Beyond</p>
                </div>
                <p style="color: #2c3e50; margin-top: 20px;">Experience the best cruise booking platform with exclusive deals and premium customer service.</p>
            </div>

            <div class="footer-section">
                <h4>Quick Links</h4>
                <ul class="footer-links">
                    <li><a href="{% url 'home' %}">Home</a></li>
                </ul>
            </div>

            <div class="footer-section">
                <h4>Contact Us</h4>
                <div class="contact-info">
                    <p><i class="fa-solid fa-envelope"></i> Steven@harborhop.com</p>
                    <p><i class="fa-solid fa-phone"></i> +1 (555) 123-4567</p>
                    <p><i class="fa-solid fa-location-dot"></i> 123 Marina Blvd, Beach City, CA</p>
                </div>
            </div>

            <div class="footer-section">
                <h4>Connect With Us</h4>
                <div class="social-media">
                    <a href="#" title="Facebook">
                        <img src="https://cdn-icons-png.flaticon.com/512/124/124010.png" alt="Facebook">
                    </a>
                    <a href="#" title="Twitter">
                        <img src="https://cdn-icons-png.flaticon.com/512/3256/3256013.png" alt="Twitter">
                    </a>
                    <a href="#" title="Instagram">
                        <img src="https://cdn-icons-png.flaticon.com/512/174/174855.png" alt="Instagram">
                    </a>
                </div>
                <div style="margin-top: 20px;">
                    <h4>Newsletter</h4>
                    <form style="display: flex; gap: 10px;">
                        <input type="email" placeholder="Enter your email" style="padding: 8px; border-radius: 4px; border: none; flex: 1;">
                        <button type="submit" style="background: #ff9900; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer;">Subscribe</button>
                    </form>
                </div>
            </div>
        </div>
        
        <div class="footer-bottom">
            <p>&copy; 2025 HarborHop. All rights reserved. | <a href="#">Privacy Policy</a> | <a href="#">Terms of Service</a></p>
        </div>
    </footer>

    <script>
        // Store routes data globally
        let routesData = [];
        
        function incrementCounter(btn) {
            const counterValue = btn.previousElementSibling.previousElementSibling;
            const hiddenInput = btn.previousElementSibling;
            let count = parseInt(counterValue.textContent);
            count++;
            counterValue.textContent = count;
            hiddenInput.value = count;
        }

        function decrementCounter(btn) {
            const counterValue = btn.nextElementSibling;
            const hiddenInput = btn.nextElementSibling.nextElementSibling;
            let count = parseInt(counterValue.textContent);
            if (count > 0) {
                count--;
                counterValue.textContent = count;
                hiddenInput.value = count;
            }
        }
        
        function swapLocations() {
            const origin = document.querySelector('select[name="origin"]');
            const destination = document.querySelector('select[name="destination"]');
            const temp = origin.value;
            origin.value = destination.value;
            destination.value = temp;
            
            // Update destinations for the new origin
            if (origin.value) {
                updateDestinations(parseInt(origin.value));
            }
        }
        
        // Load locations from Barkota API
        async function loadLocations() {
            try {
                const response = await fetch('/api/locations/');
                const data = await response.json();
                
                if (data.success) {
                    routesData = data.data;
                    populateOrigins();
                } else {
                    console.error('Failed to load locations:', data.message);
                    showLocationError();
                }
            } catch (error) {
                console.error('Error loading locations:', error);
                showLocationError();
            }
        }
        
        function populateOrigins() {
            const originSelect = document.getElementById('origin-select');
            originSelect.innerHTML = '<option value="">Select Origin Port</option>';
            
            // Sort routes by origin name
            const sortedRoutes = [...routesData].sort((a, b) => 
                a.origin.name.localeCompare(b.origin.name)
            );
            
            sortedRoutes.forEach(route => {
                const origin = route.origin;
                const option = document.createElement('option');
                option.value = origin.id;
                option.textContent = `${origin.name}${origin.province ? ' (' + origin.province + ')' : ''}`;
                originSelect.appendChild(option);
            });
        }
        
        function updateDestinations(originId) {
            const destSelect = document.getElementById('destination-select');
            destSelect.innerHTML = '<option value="">Select Destination Port</option>';
            
            // Find the route for this origin
            const route = routesData.find(r => r.origin.id === originId);
            
            if (route && route.destinations && route.destinations.length > 0) {
                // Sort destinations by name
                const sortedDests = [...route.destinations].sort((a, b) => 
                    a.name.localeCompare(b.name)
                );
                
                sortedDests.forEach(dest => {
                    const option = document.createElement('option');
                    option.value = dest.id;
                    option.textContent = `${dest.name}${dest.province ? ' (' + dest.province + ')' : ''}`;
                    destSelect.appendChild(option);
                });
            } else {
                destSelect.innerHTML = '<option value="">No destinations available</option>';
            }
        }
        
        function showLocationError() {
            const originSelect = document.getElementById('origin-select');
            originSelect.innerHTML = '<option value="">Error loading locations. Please refresh.</option>';
        }
        
        // Handle trip type change
        document.addEventListener('DOMContentLoaded', function() {
            // Load locations from API
            {% if user.is_authenticated %}
                loadLocations();
            {% else %}
                document.getElementById('origin-select').innerHTML = '<option value="">Please login to search</option>';
                document.getElementById('destination-select').innerHTML = '<option value="">Please login to search</option>';
            {% endif %}
            
            const tripTypeRadios = document.querySelectorAll('input[name="trip_type"]');
            const returnDateGroup = document.getElementById('return-date-group');
            const returnDateInput = document.getElementById('return-date-input');
            
            tripTypeRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.value === 'one_way') {
                        returnDateGroup.style.opacity = '0.5';
                        returnDateInput.disabled = true;
                        returnDateInput.required = false;
                    } else {
                        returnDateGroup.style.opacity = '1';
                        returnDateInput.disabled = false;
                        returnDateInput.required = true;
                    }
                });
            });
            
            // Set minimum date to today
            const today = new Date().toISOString().split('T')[0];
            document.querySelector('input[name="departure_date"]').setAttribute('min', today);
            returnDateInput.setAttribute('min', today);
            
            // Handle origin change
            document.getElementById('origin-select').addEventListener('change', function(e) {
                const originId = parseInt(e.target.value);
                if (originId) {
                    updateDestinations(originId);
                } else {
                    document.getElementById('destination-select').innerHTML = '<option value="">Select origin first</option>';
                }
            });
        });
    </script>
</body>
</html>